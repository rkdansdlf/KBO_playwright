# 일간 업데이트 가이드 (v2)

## 1. 개요

일간 업데이트는 **정규시즌**의 최신 경기 결과를 반영하고, **퓨처스리그**의 변경 사항을 동기화하는 자동화된 프로세스입니다.

## 2. 정규시즌: 야간 롤업 (Nightly Roll-up)

정규시즌 데이터는 매일 밤 `경기 단위 기록`을 `시즌 누적 기록`으로 집계하는 **야간 롤업(Nightly Roll-up)** 방식으로 업데이트됩니다.

### 2.1. 실행 순서

1.  **당일 경기 데이터 수집:** `scripts/crawl_games.py` 스크립트를 통해 당일 종료된 모든 경기의 상세 데이터(박스스코어, PBP 등)를 수집하여 `GAME_STATS` 테이블에 저장합니다.
2.  **시즌 누적 기록 집계:** `src/utils/aggregate_season_stats.py` 스크립트가 `GAME_STATS`의 원천 데이터를 기반으로 선수별 시즌 누적 통계(타율, ERA 등)를 다시 계산합니다.
3.  **시즌 통계 업데이트:** 계산된 누적 통계를 `SEASON_STATS` 테이블에 `UPSERT`(UPDATE or INSERT) 합니다.

### 2.2. 멱등성 보장
- 모든 데이터 저장 작업은 **UPSERT** 방식을 사용합니다. (예: `INSERT ... ON DUPLICATE KEY UPDATE`)
- 따라서 스크립트를 여러 번 재실행하더라도 데이터가 중복으로 쌓이지 않으며, 항상 최종 상태의 일관성을 보장합니다.

## 3. 퓨처스리그: 주간/일간 동기화

퓨처스리그 데이터는 선수 프로필 페이지에서 직접 수집하므로, 시즌 중 데이터 변경 빈도가 낮습니다.

- **권장 주기:** **주 1회** 또는 **일 1회** 동기화를 권장합니다.
- **프로세스:** `src/crawlers/player_profile_crawler.py`를 실행하여 전체 선수의 프로필을 재수집하고, 퓨처스리그 탭의 통계에 변경이 있는 경우에만 `SEASON_STATS` 테이블을 업데이트합니다. (`league='FUTURES'` 조건)
- **특징:** 프로필 기반 수집은 KBO 사이트 관리자가 데이터를 업데이트할 때만 변경되므로, 정규시즌처럼 매일 실행할 필요는 없습니다.

## 4. 자동화 (Scheduler)

`scheduler.py`는 아래 두 작업을 별도의 주기로 실행하도록 설정되어야 합니다.

- **정규시즌 롤업 (`crawl_games_regular`):**
  - **주기:** 매일 새벽 (예: 03:00 KST)
  - **작업:** 당일 경기 수집 및 시즌 통계 집계

- **퓨처스리그 동기화 (`crawl_futures_profile`):**
  - **주기:** 매주 일요일 새벽 (예: 05:00 KST)
  - **작업:** 전체 선수 프로필의 퓨처스 기록 수집 및 업데이트

*(상세 설정은 `SCHEDULER_README.md` 참조)*
